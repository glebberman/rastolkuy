# Основные требования
Весь PHP код проекта должен соответствовать стандарту phpstan 9 уровня + larastan, быть рассчитан на актуальные версии пакетов, библиотек и фреймворка Laravel 11, а также установленным стандартам и правилам написания кода.

## Как создавать DTO для запросов
Объект запроса сам по себе содержит много информации, и таскать его между слоями приложения не всегда удобно, поэтому если запрос будет дальше обрабатываться сервисом или чем-то еще, то для него необходимо создать DTO. Это позволит нам более легко повторно использовать реализованный функционал.

Следует придерживаться стилям кода, который используется в уже реализованных файлах проекта.
Существующие файлы того же типа следует использовать как образцы.

## Правила изменения стиля кода
При самостоятельном изменении стиля кода (отступы, пробелы, переносы строк и т.д.) разработчик должен вносить изменения **только** в код, который создается или модифицируется в рамках текущей задачи, если нет прямого указания на обратное.

Автоматические инструменты (`cs-fix`, `phpstan`) применяются как обычно ко всему проекту.

Исключения для ручного изменения стиля составляют случаи, когда:
- Пользователь явно просит исправить стиль во всем проекте  
- Задача специально посвящена рефакторингу кода

## GIT
Именовать ветки по названию задачи с префиксом RAS-, например: RAS-123 (Если номер не указан, уточнять его у пользователя)

## Правила для DTO
- Нельзя писать логику. Например вызов каких либо сервисов, поиск в базе и т.д.
- Все поля должны быть публичными
- Обязательно final readonly
- Обязательно метод создания из конкретного FormRequest, данные брать из $request->validated()

## Как создавать новый эндпоинт

Каждый пункт принимать как ОБЯЗАТЕЛЬНО если не сказано иное
Термины
JsonResource - имеется в виду функционал указанный в этой документации
Правила:

- Настройка роута API определяются в файле api.php, фронта в web.php
- Путь эндпоинта API должен содержать api
- Пути фронтенда не должны содержать префиксов
- Обработка эндпоинтов в контроллерах или в экшенах
- В качестве аргумента методов обработчиков, может только кастомный запрос или route binding
- Если запрос нужно передать дальше в обработку, то нужно его превратить в дто в котором будут только валидные данные
- Если для обработки нужно вызвать сервис, то его надо прописать в конструкторе
- Ответом может быть только JsonResource
- В JsonResource надо перечислить все поля
- Если используется ResourceCollection, то в методе toArray разрешается просто возвращать $this->collection
- Для каждого ResourceCollection должен существовать соответствующий JsonResource. Например, для UserResourceCollection обязательно должен быть UserResource в том же namespace
- В аннотациях к JsonResource всегда прописывать @mixin название_модели, например @mixin User
- В контроллерах не может быть логики, только валидация, все остальное должно быть в сервисных методах
- Проверка на то что может залогиненный пользователь или нет, осуществлять только через политики
- Классы вызывать через импорт use а не полной ссылкой, при необходимости можно использовать alias классов
